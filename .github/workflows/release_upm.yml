name: release for upm
on:
  push:
    branches:
    - master
jobs:
  split-upm:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Modify package.json
        run: echo "`jq '.version = "6.6.0"' ./Assets/AppsFlyer/package.json`" > ./Assets/AppsFlyer/package.json
      - name: Commit changes
        run: |
          git config --global user.name ${{ secrets.GITHUB_USERNAME }}
          git config --global user.email ${{ secrets.GITHUB_USER_EMAIL }}

          git add -A
          git commit -m "commit message"
      - name: split branch
        run: |
          git branch -d upm &> /dev/null || echo upm branch not found
          git subtree split -P Assets/AppsFlyer -b upm
          git checkout upm
          git push -f -u origin upm
    env:
        PKG_ROOT: Assets/AppsFlyer
